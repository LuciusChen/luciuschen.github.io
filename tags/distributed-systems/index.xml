<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>distributed-systems on Lucius&#39;s PKM</title>
    <link>https://luciuschen.github.io/tags/distributed-systems/</link>
    <description>Recent content in distributed-systems on Lucius&#39;s PKM</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 10 Jun 2022 22:59:20 +0800</lastBuildDate><atom:link href="https://luciuschen.github.io/tags/distributed-systems/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Vector Clocks</title>
      <link>https://luciuschen.github.io/posts/main/20220602235916-vector_clocks/</link>
      <pubDate>Fri, 10 Jun 2022 22:59:20 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220602235916-vector_clocks/</guid>
      <description>Vector clocks Given Lamport timestamps L(a) and L(b) with L(a) &amp;lt; L(b)ï¼Œæˆ‘ä»¬æ¨æ–­ä¸å‡º a â†’ b æˆ–è€… a || b.1 è¦åŒºåˆ†å¹³è¡Œçš„è¿™äº›äº‹ä»¶ï¼Œéœ€è¦ vertor clocks: å‡å®šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ n ä¸ªèŠ‚ç‚¹ï¼ŒN = âŸ¨ N1, N2, &amp;hellip;, Nn âŸ© äº‹ä»¶ a</description>
      <content:encoded><![CDATA[<h2 id="vector-clocks">Vector clocks</h2>
<p>Given Lamport timestamps L(a) and L(b) with L(a) &lt; L(b)ï¼Œæˆ‘ä»¬æ¨æ–­ä¸å‡º a â†’ b æˆ–è€… a || b.<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>è¦åŒºåˆ†å¹³è¡Œçš„è¿™äº›äº‹ä»¶ï¼Œéœ€è¦ <strong>vertor clocks</strong>:</p>
<ul>
<li>å‡å®šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ n ä¸ªèŠ‚ç‚¹ï¼ŒN = âŸ¨ N<sub>1</sub>, N<sub>2</sub>, &hellip;, N<sub>n</sub> âŸ©</li>
<li><strong>äº‹ä»¶ a</strong> çš„çŸ¢é‡æ—¶é—´æˆ³å†™æˆ V(a) = âŸ¨ t<sub>1</sub>, t<sub>2</sub>, &hellip;, t<sub>n</sub> âŸ©</li>
<li>t<sub>ğ’Š</sub> æ˜¯ N<sub>ğ’Š</sub> èŠ‚ç‚¹å‘ç”Ÿæ—¶é—´çš„æ•°é‡</li>
<li>æ¯ä¸ªâ€‹â€‹<strong>èŠ‚ç‚¹</strong>â€‹éƒ½æœ‰ä¸€ä¸ªå½“å‰çš„çŸ¢é‡æ—¶é—´æˆ³ T</li>
<li>èŠ‚ç‚¹ N<sub>ğ’Š</sub> ä¸Šçš„äº‹ä»¶ï¼ŒçŸ¢é‡æ—¶é—´æˆ³ T[ğ’Š] é€’å¢ã€‚</li>
<li>æ¯ä¸ªæ¶ˆæ¯éƒ½é™„å¸¦ä¸ŠçŸ¢é‡æ—¶é—´æˆ³</li>
<li>æ¥æ”¶è€… &lt;mi&gt;i&lt;/mi&gt;</li>
</ul>
<p>é™¤äº†æ ‡é‡å’ŒçŸ¢é‡ä¹‹é—´çš„åŒºåˆ«ä¹‹å¤–ï¼ŒçŸ¢é‡æ—¶é’Ÿç®—æ³•ä¸ Lamport æ—¶é’Ÿéå¸¸ç›¸ä¼¼ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„çŸ¢é‡æ—¶é’Ÿçš„åˆå§‹å€¼æ˜¯ç³»ç»Ÿä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„äº‹ä»¶æ•°ï¼Œä¹Ÿå°±æ˜¯ 0ã€‚æ¯å½“èŠ‚ç‚¹ N<sub>ğ’Š</sub> å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œå®ƒå°±ä¼šå¢åŠ å…¶å‘é‡é’Ÿä¸­çš„ç¬¬ ğ’Š ä¸ªæ¡ç›®ï¼ˆå®ƒè‡ªå·±çš„æ¡ç›®ï¼‰ã€‚(In practice, this vector is often implemented as a map from node IDs to integers rather than an array of integers. åœ¨å®è·µä¸­ï¼Œè¿™é‡Œçš„å‘é‡é€šå¸¸æ˜¯èŠ‚ç‚¹ ID å¯¹åº” Integer çš„ mapï¼Œè€Œä¸æ˜¯ Integer çš„æ•°ç»„ã€‚)ã€‚å½“ä¸€ä¸ªæ¶ˆæ¯åœ¨ç½‘ç»œä¸Šè¢«å‘é€æ—¶ï¼Œå‘é€è€…å½“å‰çš„å‘é‡æ—¶é—´æˆ³è¢«é™„åŠ åˆ°è¯¥æ¶ˆæ¯ä¸Šã€‚æœ€åï¼Œå½“ä¸€ä¸ªæ¶ˆæ¯è¢«æ¥æ”¶æ—¶ï¼Œæ¥æ”¶è€…å°†æ¶ˆæ¯ä¸­çš„å‘é‡æ—¶é—´æˆ³ä¸å®ƒçš„æœ¬åœ°æ—¶é—´æˆ³åˆå¹¶ï¼Œæ–¹æ³•æ˜¯å–ä¸¤ä¸ªå‘é‡çš„å…ƒç´ çš„æœ€å¤§å€¼ï¼Œç„¶åæ¥æ”¶è€…å¢åŠ å®ƒè‡ªå·±çš„æ¡ç›®ã€‚</p>
<p>V(a) â‰¤ V(b) iff ({a} âˆª {e|e â†’ a}) âŠ† ({b} âˆª {e|e â†’ b})</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>å…·ä½“å‚è€ƒ <a href="/posts/main/20220609201658-lamport_clocks/">Lamport Clocks</a> ä¸­çš„é€»è¾‘åŒæ¡ä»¶ã€‚&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>Lamport Clocks</title>
      <link>https://luciuschen.github.io/posts/main/20220609201658-lamport_clocks/</link>
      <pubDate>Fri, 10 Jun 2022 22:46:54 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220609201658-lamport_clocks/</guid>
      <description>Lamport clocks algorithm on initialisation do t := 0 â–» each node has its own local variable t end on on any event occurring at the local node do t := t + 1 end on on request to send message m do t := t + 1; send (t, m) via the underlying network link end on on receiving (tâ€², m) via the underlying network link</description>
      <content:encoded><![CDATA[<h2 id="lamport-clocks-algorithm">Lamport clocks algorithm</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">on initialisation do
</span></span><span class="line"><span class="cl">t := 0                    â–» each node has its own local variable t
</span></span><span class="line"><span class="cl">end on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">on any event occurring at the local node do
</span></span><span class="line"><span class="cl">t := t + 1
</span></span><span class="line"><span class="cl">end on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">on request to send message m do
</span></span><span class="line"><span class="cl">t := t + 1; send (t, m) via the underlying network link
</span></span><span class="line"><span class="cl">end on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">on receiving (tâ€², m) via the underlying network link do
</span></span><span class="line"><span class="cl">t := max(t, tâ€²) + 1
</span></span><span class="line"><span class="cl">deliver m to the application
</span></span><span class="line"><span class="cl">end on
</span></span></code></pre></div><h3 id="lamport-clocks-in-words">Lamport clocks in words</h3>
<figure>
    <img loading="lazy" src="/ox-hugo/lamport-example-simple.png"
         alt="Figure 1: lamport-example-simple"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>lamport-example-simple</p>
        </figcaption>
</figure>

<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ <code>t</code> ï¼Œæ¯ä¸€ä¸ªå½“å‰èŠ‚ç‚¹äº‹ä»¶ <code>e</code> å‘ç”Ÿæ—¶ï¼Œè‡ªå¢ 1ã€‚</li>
<li>å¢é•¿åçš„å€¼è®¾ä¸º <code>L(e)</code></li>
<li>å‘é€æ¶ˆæ¯æ—¶é™„å¸¦ä¸Šå½“å‰çš„è®¡æ•° <code>t</code></li>
<li>æ¶ˆæ¯æ¥å—è€…åœ¨æ¶ˆæ¯ä¸­çš„æ—¶é—´æˆ³å’Œå½“å‰èŠ‚ç‚¹çš„æ—¶é—´æˆ³ä¹‹é—´å–æœ€å¤§å€¼åè‡ªå¢ 1</li>
</ul>
<p>Properties of this scheme:</p>
<ul>
<li>if a â†’ b then L(e) &lt; L(b)</li>
<li>However, L(a) &lt; L(b) does not imply a â†’ b</li>
<li>Possible that L(a) = L(b) for a â‰  b ()</li>
</ul>
<p>Lamport æ—¶é—´æˆ³æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨æ¥è®¡ç®—å·²å‘ç”Ÿäº‹ä»¶çš„æ•°é‡ã€‚å› æ­¤ï¼Œå®ƒä¸ç‰©ç†æ—¶é—´æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ—¶é—´éƒ½ä¼šå¢åŠ ï¼Œå› ä¸ºæ¯ä¸ªäº‹ä»¶çš„æ•´æ•°éƒ½ä¼šé€’å¢ã€‚è¯¥ç®—æ³•å‡è®¾äº†ä¸€ä¸ª crash-stop æ¨¡å‹ï¼ˆå¦‚æœæ—¶é—´æˆ³è¢«ä¿æŒåœ¨ç¨³å®šçš„å­˜å‚¨ä¸­ï¼Œå³åœ¨ç£ç›˜ä¸Šï¼Œåˆ™æ˜¯ crash-recovery æ¨¡å‹ï¼‰ã€‚</p>
<h3 id="lamport-clocks-example">Lamport clocks example</h3>
<figure>
    <img loading="lazy" src="/ox-hugo/lamport-example.png"
         alt="Figure 2: lamport-example"/> <figcaption>
            <p><span class="figure-number">Figure 2: </span>lamport-example</p>
        </figcaption>
</figure>

<p>Let N(e) be the node at which event e occurred.</p>
<p>Then the pair (L(e), N(e)) <strong>uniquely identiï¬es</strong> event e.</p>
<p>Deï¬ne a <strong>total order</strong> â‰º using Lamport timestamps:</p>
<p>(a â‰º b) â‡” (L(a) &lt; L(b) âˆ¨ (L(a) = L(b) âˆ§ N(a) &lt; N(b)))<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><sup>, </sup><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>This order is <strong>causal</strong>: (a â†’ b) â‡’ (a â‰º b)</p>
<p>å›é¡¾ä¹‹å‰çš„ happens-before relation æ˜¯å±€éƒ¨é¡ºåºã€‚åˆ©ç”¨ Lamport æ—¶é—´æˆ³å¯ä»¥å°†è¿™ç§å±€éƒ¨çš„é¡ºåºæ‰©å±•åˆ°å…¨å±€é¡ºåºã€‚å¯ä»¥ç”¨ï¼ˆæ—¶é—´æˆ³, èŠ‚ç‚¹åç§°) ç»„åˆï¼šé¦–å…ˆæ¯”è¾ƒæ—¶é—´æˆ³ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™æ¯”è¾ƒèŠ‚ç‚¹åç§°ã€‚</p>
<p>å¯¹äºä»»ä½•ä¸¤ä¸ªäº‹ä»¶ a =Ì¸ bï¼Œé‚£ä¹ˆæ—¢ä¸æ˜¯ a â‰º b ä¹Ÿä¸æ˜¯ b â‰º aã€‚åªè¦ a â†’ bï¼Œæˆ‘ä»¬å°±æœ‰ a â‰º bï¼Œæ¢å¥è¯è¯´ï¼Œâ‰º æ˜¯å±€éƒ¨é¡ºåº â†’ çš„çº¿æ€§æ‰©å±•ã€‚ç„¶è€Œï¼Œå¦‚æœ a || bï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ a â‰º b æˆ– b â‰º aï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹ä»¶çš„é¡ºåºæ˜¯ç”±ç®—æ³•ä»»æ„å†³å®šçš„ã€‚ æ¯”å¦‚ (1, A) å’Œ (1, C) ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹³è¡Œçš„ï¼ŒæŒ‰ç…§ Lamport çš„ç®—æ³•ï¼Œ(1, A) å¿…ç„¶æ˜¯åœ¨ (1, C) ä¹‹å‰çš„ï¼Œä½†å®é™…æƒ…å†µå¯èƒ½æ˜¯ (1, C) åœ¨å‰ã€‚</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>â‡” is Logical biconditionalï¼Œå½“ä¸”ä»…å½“çš„æ„æ€ã€‚&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>âˆ¨ is logical or, âˆ§ is logical and.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>The two generals problem</title>
      <link>https://luciuschen.github.io/posts/main/20220602202247-the_two_generals_problem/</link>
      <pubDate>Fri, 10 Jun 2022 15:18:34 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220602202247-the_two_generals_problem/</guid>
      <description>ä¸¤å†›é—®é¢˜ï¼ˆè‹±è¯­ï¼šTwo Generals&amp;rsquo; Problemï¼‰æ˜¯è®¡ç®—æœºé¢†åŸŸä¸­çš„ä¸€ä¸ªæ€æƒ³å®éªŒã€‚ä¸¤å†›é—®é¢˜æ˜¾ç¤ºï¼Œé€šè¿‡ä¸å¯é çš„é€šä¿¡é€šé“äº¤æ¢ä¿¡æ¯å¹¶è¾¾æˆå…±è¯†æ˜¯éš¾ä»¥å®ç°çš„ã€‚åœ¨è¯¥</description>
      <content:encoded><![CDATA[<p>ä¸¤å†›é—®é¢˜ï¼ˆè‹±è¯­ï¼šTwo Generals&rsquo; Problemï¼‰æ˜¯è®¡ç®—æœºé¢†åŸŸä¸­çš„ä¸€ä¸ªæ€æƒ³å®éªŒã€‚ä¸¤å†›é—®é¢˜æ˜¾ç¤ºï¼Œé€šè¿‡ä¸å¯é çš„é€šä¿¡é€šé“äº¤æ¢ä¿¡æ¯å¹¶è¾¾æˆå…±è¯†æ˜¯éš¾ä»¥å®ç°çš„ã€‚åœ¨è¯¥é—®é¢˜ä¸­ï¼Œä¸¤æ”¯å†›é˜Ÿçš„å°†å†›åªèƒ½é€šè¿‡æ´¾é£ä¿¡ä½¿ç©¿è¶Šæ•Œæ–¹é¢†åœŸæ¥äº’ç›¸é€šä¿¡ï¼Œä»¥æ­¤çº¦å®šåœ¨åŒä¸€æ—¶é—´ç‚¹å…±åŒè¿›æ”»ã€‚è¯¥é—®é¢˜å¸Œæœ›æ±‚è§£å¦‚ä½•åœ¨ä¸¤ä½å°†å†›æ´¾å‡ºçš„ä»»ä½•ä¿¡ä½¿éƒ½å¯èƒ½è¢«ä¿˜è™çš„æƒ…å†µä¸‹ï¼Œå°±å‘åŠ¨æ”»å‡»çš„æ—¶é—´ç‚¹è¾¾æˆä¸€è‡´ã€‚</p>
<p>ä¸¤å†›é—®é¢˜æ˜¯æ‹œå åº­å°†å†›é—®é¢˜çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¸¸è¢«ç¼–å…¥ä¸è®¡ç®—æœºç½‘ç»œç›¸å…³çš„å…¥é—¨è¯¾ç¨‹ä¸­ã€‚åœ¨ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰ç›¸å…³çš„è¯¾ç¨‹ä¸­ï¼Œè¯¥é—®é¢˜å¯ç”¨ä½œè§£é‡Š TCP åè®®æ— æ³•ä¿è¯é€šä¿¡åŒæ–¹ä¹‹é—´çš„çŠ¶æ€ä¸€è‡´æ€§çš„åŸå› ã€‚è¯¥é—®é¢˜ä¹Ÿé€‚ç”¨äºå…¶ä»–å­˜åœ¨ä¿¡æ¯ä¸¢å¤±çš„åŒæ–¹é€šä¿¡çš„æƒ…å†µã€‚ä½œä¸ºè®¤è¯†é€»è¾‘çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œè¯¥é—®é¢˜çªå‡ºäº†å…±è¯†ï¼ˆè‹±è¯­ï¼šCommon_knowledge_(logic)ï¼‰çš„é‡è¦æ€§ã€‚ä¸€äº›å­¦è€…ä¹Ÿå°†æ­¤é—®é¢˜ç§°ä½œä¸¤å†›æ‚–è®ºï¼ˆè‹±è¯­ï¼šTwo Generals Paradoxï¼‰æˆ–ååŒè¿›æ”»é—®é¢˜ï¼ˆè‹±è¯­ï¼šCoordinated Attack Problemï¼‰ã€‚ä¸¤å†›é—®é¢˜æ˜¯ç¬¬ä¸€ä¸ªè¢«è¯æ˜æ— è§£çš„è®¡ç®—æœºé€šä¿¡é—®é¢˜ã€‚è¯¥è¯æ˜çš„é‡è¦æ„ä¹‰åœ¨äºï¼Œå…¶æ˜¾ç¤ºäº†å¯¹äºå­˜åœ¨é€šä¿¡é”™è¯¯çš„æ›´å¹¿æ³›çš„é—®é¢˜ï¼ˆå¦‚æ‹œå åº­å°†å†›é—®é¢˜ï¼‰ï¼ŒåŒæ ·æ˜¯æ— è§£çš„ã€‚è¿™ä¹Ÿä¸ºæ‰€æœ‰åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®çš„å®ç°æä¾›äº†ä¸€ä¸ªç¬¦åˆç°å®çš„é¢„æœŸã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>The Byzantine generals problem</title>
      <link>https://luciuschen.github.io/posts/main/20220602202317-the_byzantine_generals_problem/</link>
      <pubDate>Fri, 10 Jun 2022 15:18:28 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220602202317-the_byzantine_generals_problem/</guid>
      <description>æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆByzantine Generals Problemï¼‰ï¼Œæ˜¯ç”±è±æ–¯åˆ©Â·å…°æ³¢ç‰¹åœ¨å…¶åŒåè®ºæ–‡ä¸­æå‡ºçš„åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œé€šä¿¡å®¹é”™é—®é¢˜ã€‚ åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­ï¼Œä¸åŒ</description>
      <content:encoded><![CDATA[<p>æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆByzantine Generals Problemï¼‰ï¼Œæ˜¯ç”±è±æ–¯åˆ©Â·å…°æ³¢ç‰¹åœ¨å…¶åŒåè®ºæ–‡ä¸­æå‡ºçš„åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œé€šä¿¡å®¹é”™é—®é¢˜ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­ï¼Œä¸åŒçš„è®¡ç®—æœºé€šè¿‡é€šè®¯äº¤æ¢ä¿¡æ¯è¾¾æˆå…±è¯†è€ŒæŒ‰ç…§åŒä¸€å¥—åä½œç­–ç•¥è¡ŒåŠ¨ã€‚ä½†æœ‰æ—¶å€™ï¼Œç³»ç»Ÿä¸­çš„æˆå‘˜è®¡ç®—æœºå¯èƒ½å‡ºé”™è€Œå‘é€é”™è¯¯çš„ä¿¡æ¯ï¼Œç”¨äºä¼ é€’ä¿¡æ¯çš„é€šè®¯ç½‘ç»œä¹Ÿå¯èƒ½å¯¼è‡´ä¿¡æ¯æŸåï¼Œä½¿å¾—ç½‘ç»œä¸­ä¸åŒçš„æˆå‘˜å…³äºå…¨ä½“åä½œçš„ç­–ç•¥å¾—å‡ºä¸åŒç»“è®ºï¼Œä»è€Œç ´åç³»ç»Ÿä¸€è‡´æ€§ã€‚æ‹œå åº­å°†å†›é—®é¢˜è¢«è®¤ä¸ºæ˜¯å®¹é”™æ€§é—®é¢˜ä¸­æœ€éš¾çš„é—®é¢˜ç±»å‹ä¹‹ä¸€ã€‚</p>
<p>å®¹é”™ç‡ï¼šTheorem: need 3Æ’+1 generals in total to tolerate Æ’ malicious generals.</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Stub</title>
      <link>https://luciuschen.github.io/posts/main/20220604180341-stub/</link>
      <pubDate>Fri, 10 Jun 2022 15:18:21 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220604180341-stub/</guid>
      <description>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œstub å¾ˆå¤šæ—¶å€™å°±æ˜¯é’ˆå¯¹ä¸å¯æ§åˆ¶çš„éƒ¨åˆ†è¿›è¡Œæ¨¡æ‹Ÿï¼Œä¾‹å¦‚ Mockã€‚ åœ¨åˆ†å¸ƒå¼ä¸­ï¼Œstub å°±æ˜¯ç”¨äºè½¬æ¢è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æœŸé—´å®¢æˆ·ç«¯</description>
      <content:encoded><![CDATA[<ol>
<li>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œstub å¾ˆå¤šæ—¶å€™å°±æ˜¯é’ˆå¯¹ä¸å¯æ§åˆ¶çš„éƒ¨åˆ†è¿›è¡Œæ¨¡æ‹Ÿï¼Œä¾‹å¦‚ Mockã€‚</li>
<li>åœ¨åˆ†å¸ƒå¼ä¸­ï¼Œstub å°±æ˜¯ç”¨äºè½¬æ¢è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æœŸé—´å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¼ é€’å‚æ•°çš„ä¸€æ®µä»£ç ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>Remote Procedure Call (RPC)</title>
      <link>https://luciuschen.github.io/posts/main/20220603220847-remote_procedure_call_rpc/</link>
      <pubDate>Fri, 10 Jun 2022 15:18:14 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220603220847-remote_procedure_call_rpc/</guid>
      <description>Remote Procedure Call æ˜¯ä¸€ç§=è½¯ä»¶é€šä¿¡åè®®=ï¼Œç¨‹åºå¯ä»¥åœ¨ä¸äº†è§£ç½‘ç»œç»†èŠ‚çš„å‰æä¸‹ï¼Œå‘ä½äºç½‘ç»œä¸Šçš„å¦å¤–ä¸€å°è®¡ç®—æœºä¸­çš„æœ¬åœ°ç¨‹åºè¯·æ±‚æœåŠ¡ã€‚PRC è¢«ç”¨æ¥åƒæœ¬åœ°ç³»ç»Ÿä¸€æ ·</description>
      <content:encoded><![CDATA[<p>Remote Procedure Call æ˜¯ä¸€ç§=è½¯ä»¶é€šä¿¡åè®®=ï¼Œç¨‹åºå¯ä»¥åœ¨ä¸äº†è§£ç½‘ç»œç»†èŠ‚çš„å‰æä¸‹ï¼Œå‘ä½äºç½‘ç»œä¸Šçš„å¦å¤–ä¸€å°è®¡ç®—æœºä¸­çš„æœ¬åœ°ç¨‹åºè¯·æ±‚æœåŠ¡ã€‚PRC è¢«ç”¨æ¥åƒæœ¬åœ°ç³»ç»Ÿä¸€æ ·è°ƒç”¨è¿œç¨‹ç³»ç»Ÿä¸Šçš„å…¶ä»–è¿›ç¨‹ã€‚</p>
<p>RPC æ˜¯é€šè¿‡ Interface Definition Language (IDL) æ¥æè¿°æ¥å£ï¼Œä½¿å¾—åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œçš„ä¸åŒç¨‹åºç¼–å†™çš„ç¨‹åºå¯ä»¥ç›¸äº’é€šä¿¡ã€‚(IDL æ˜¯ä¸ä»¥ä»»ä½•ä¸€ç§ç‰¹å®šç¼–ç¨‹è¯­è¨€çš„æ–¹å¼æŒ‡å®šç±»å‹ç­¾åæˆ–è€…å‡½æ•°è°ƒç”¨çš„è¯­è¨€ã€‚)</p>
<p>åŸºæœ¬ä¸Šï¼Œä½ å¯ä»¥ç”¨ IDL å®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„æ¥å£ï¼Œè¿™æ · RPC æœºåˆ¶å°±å¯ä»¥åˆ›å»ºè·¨ç½‘ç»œè°ƒç”¨åŠŸèƒ½æ‰€éœ€è¦çš„ä»£ç å­˜æ ¹ï¼ˆCode <a href="/posts/main/20220604180341-stub/">Stub</a>ï¼‰ã€‚</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">+----------------+
| Client         |
|  +----------+  |         +---------------+
|  |   main   |  |         | Server        |
|  |----------|  |         |  +----------+ |
|  | stub_cli |----(comms)---&gt;| stub_svr | |
|  +----------+  |         |  |----------| |
+----------------+         |  | function | |
                           |  +----------+ |
                           +---------------+
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ~main~ æ²¡æœ‰åœ¨åŒä¸€ä¸ªç¨‹åºä¸­è°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯è°ƒç”¨äº†ä¸€ä¸ªå®¢æˆ·ç«¯å­˜æ ¹å‡½æ•°ï¼ˆä¸å‡½æ•°çš„åŸå‹ç›¸åŒï¼‰ï¼Œè¯¥å‡½æ•°è´Ÿè´£å°†ä¿¡æ¯æ‰“åŒ…ï¼Œå¹¶é€šè¿‡é€šè®¯é€šé“å°†å…¶ä¼ é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>è¿™é‡Œå¯ä»¥æ˜¯åŒä¸€å°æœºå™¨æˆ–è€…ä¸åŒæœºå™¨ï¼ŒRPC çš„ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿéšæ„ç§»åŠ¨æœåŠ¡å™¨ã€‚</p>
<p>åœ¨æœåŠ¡å™¨ä¸­ï¼Œæœ‰ä¸ªã€Œç›‘å¬è€…ã€è¿›ç¨‹ï¼Œå®ƒå°†æ¥æ”¶è¿™äº›ä¿¡æ¯å¹¶å°†å…¶ä¼ é€’ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨çš„å­˜æ ¹æ¥æ”¶ä¿¡æ¯ï¼Œè§£åŒ…å¹¶å°†å…¶ä¼ é€’ç»™çœŸæ­£æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
<p>çœŸæ­£çš„å‡½æ•°è¿è¡Œåè¿”å›ç»“æœç»™åˆ°æœåŠ¡å™¨å­˜æ ¹ï¼ŒæœåŠ¡å™¨å­˜æ ¹å¯ä»¥å°†è¿”å›çš„ä¿¡æ¯æ‰“åŒ…ï¼Œå¹¶å°†å…¶ä¼ å›ç»™å®¢æˆ·ç«¯å­˜æ ¹ã€‚å®¢æˆ·ç«¯å­˜æ ¹å†å°†å…¶è§£åŒ…å¹¶ä¼ å›ç»™ ~main~ã€‚</p>
<p>å®é™…ä¸Šçš„ IDL å¤§æ¦‚åƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">[   uuid(f9f6be21-fd32-5577-8f2d-0800132bd567),
    version(0),
    endpoint(&#34;ncadg_ip_udp:[1234]&#34;, &#34;dds:[19]&#34;)
] interface function_iface {
    [idempotent] void function(
        [in] int handle,
        [out] int *status
    );
}
</code></pre><p>å¤´éƒ¨æ˜¯ä¸€äº›ç”¨äºé“¾æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç½‘ç»œä¿¡æ¯ï¼ŒRPC å‘ç”Ÿåœ¨ã€Œä¼šè¯å±‚ã€ä¸­ã€‚æ¥å£éƒ¨åˆ†æ‰æ˜¯ IDL ç¼–è¯‘å™¨å»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å­˜æ ¹çš„åœ°æ–¹ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èƒ½å¤Ÿè¿›è¡Œé€šè®¯ï¼Œä½¿å¾— RPC æ­£å¸¸å·¥ä½œã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Network Time Protocol (NTP)</title>
      <link>https://luciuschen.github.io/posts/main/20220602202411-network_time_protocol_ntp/</link>
      <pubDate>Fri, 10 Jun 2022 15:18:04 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220602202411-network_time_protocol_ntp/</guid>
      <description>Network Time Protocol (NTP) is an internet protocol used to synchronize with computer clock time sources in a network. It belongs to and is one of the oldest parts of the TCP/IP suite. The term NTP applies to both the protocol and the client-server programs that run on computers. Mac ä¸­å¯ä»¥åœ¨è®¾ç½®ä¸­æ‰¾åˆ° NTP æœåŠ¡å™¨çš„åœ°å€ï¼Œæ¯”å¦‚ä¸‹</description>
      <content:encoded><![CDATA[<p>Network Time Protocol (NTP) is an internet protocol used to synchronize with computer clock time sources in a network. It belongs to and is one of the oldest parts of the TCP/IP suite. The term NTP applies to both the protocol and the client-server programs that run on computers.</p>
<p>Mac ä¸­å¯ä»¥åœ¨è®¾ç½®ä¸­æ‰¾åˆ° NTP æœåŠ¡å™¨çš„åœ°å€ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„åœ°å€å°±æ˜¯ <code>time.apple.com</code> ã€‚</p>
<figure>
    <img loading="lazy" src="/ox-hugo/ntp-in-mac.png"
         alt="Figure 1: NTP"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>NTP</p>
        </figcaption>
</figure>

<h2 id="estimating-time-over-a-network">Estimating time over a network</h2>
<figure>
    <img loading="lazy" src="/ox-hugo/NTP.png"
         alt="Figure 2: NTP"/> <figcaption>
            <p><span class="figure-number">Figure 2: </span>NTP</p>
        </figcaption>
</figure>

<ol>
<li>
<p>Round-trip network delay: Î´ = (t4 - t1) - (t3 - t2)</p>
</li>
<li>
<p>Estimated server time when client receives response: t3 + Â½Î´ï¼ˆå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æ—¶çš„æœåŠ¡å™¨çš„æ—¶é—´ï¼‰</p>
</li>
<li>
<p>Estimated clock skew: Î¸ = t3 + Â½Î´ - t4 = Â½(t2 - t1 + t3 - t4)ï¼ˆè®¡ç®—é¢„ä¼°çš„æœåŠ¡å™¨æ—¶é—´å’Œå½“å‰å®¢æˆ·ç«¯æ—¶é—´çš„åå·®ï¼‰</p>
</li>
</ol>
<h2 id="correcting-clock-skew">Correcting clock skew</h2>
<p>Once the client has estimated the clock skew Î¸, it needs to apply that correction to its clock.</p>
<ul>
<li>
<p>if Î¸ &lt; 125 ms, <strong>slew</strong> the clock:</p>
<p>slightly speed it up or slow it down by up to 500 ppm<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> (brings clocks in sync within â‰ˆ 5 minutes)</p>
</li>
<li>
<p>if 125 ms â‰¤ Î¸ &lt; 1000 s, <strong>step</strong> the clock:</p>
<p>suddenly reset client clock to estimated server timestamp</p>
</li>
<li>
<p>if Î¸ â‰¥ 1000 s, <strong>panic</strong> and do nothing (leave the problem for a human operator to resolve)</p>
</li>
</ul>
<p>ä¾é æ—¶é’ŸåŒæ­¥çš„ç³»ç»Ÿéœ€è¦ç›‘æ§æ—¶é’Ÿåç§»ã€‚ä»æœ€åä¸€æ¡å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ NTP Client å’Œ NTP Server åå·®è¿‡å¤§ï¼Œåˆ™ä¼šæ‹’ç»åŒæ­¥ NTP çš„æ—¶é—´ï¼Œç•™ç»™äººå·¥æ¥å¤„ç†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é¿å…å‡ºç°è¿™ç§åå·®è¿‡å¤§çš„æƒ…å†µã€‚</p>
<p>å½“åˆåˆå­¦ Java çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥æ™“æŸä¸ªå‡½æ•°æˆ–æŸæ®µä»£ç æ‰§è¡Œçš„æ—¶é—´ï¼Œé€šå¸¸ä¼šç”¨ <code>System.currentTimeMillis()</code> æ¥æµ‹é‡</p>
<p>åŸæ¥ <code>System.currentTimeMillis()</code> ç”¨æ¥æµ‹é‡æŸä¸ªå‡½æ•°è¿è¡Œçš„æ—¶é—´æ˜¯é”™è¯¯çš„ï¼Œä¼šå—åˆ° NTP çš„å½±å“ï¼ˆæœºç‡è™½ç„¶å¾ˆå°ï¼‰ã€‚åº”è¯¥ç”¨ <code>System.nanoTime()</code> æ¥æµ‹é‡ï¼Œä¸ä¼šå—åˆ° NTP å¾ˆå¤§çš„å½±å“ï¼Œæœ€å¤šå½±å“ã€Œå•è°ƒæ—¶é—´ã€æ­¥è¿›çš„é¢‘ç‡ã€‚</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>1 ppm = 1 microsecond/second = 86ms/day = 32s/year (ppm æ˜¯ part per million çš„ç®€ç§°)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>Causality and Happen-before relation</title>
      <link>https://luciuschen.github.io/posts/main/20220602202832-causality_and_happen_before_relation/</link>
      <pubDate>Fri, 10 Jun 2022 15:17:50 +0800</pubDate>
      
      <guid>https://luciuschen.github.io/posts/main/20220602202832-causality_and_happen_before_relation/</guid>
      <description>The Happens-before relation An event is something happening at one node (sending or receiving a message, or a local execution step). event a happens before event b, written a â†’ b. é‚£ä¹ˆåœ¨åˆ†å¸ƒå¼ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼Œæ»¡è¶³å…¶ä¸­ä¸€æ¡ï¼Œåˆ™ a æ˜¯å‘ç”Ÿåœ¨ b ä¹‹å‰ï¼š a å’Œ b å‘ç”Ÿåœ¨ç›¸åŒèŠ‚</description>
      <content:encoded><![CDATA[<h2 id="the-happens-before-relation">The Happens-before relation</h2>
<p>An <strong>event</strong> is something happening at one node (sending or receiving a message, or a local execution step).</p>
<p>event a <strong>happens before</strong> event b, written a â†’ b.</p>
<p>é‚£ä¹ˆåœ¨åˆ†å¸ƒå¼ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼Œæ»¡è¶³å…¶ä¸­ä¸€æ¡ï¼Œåˆ™ a æ˜¯å‘ç”Ÿåœ¨ b ä¹‹å‰ï¼š</p>
<ul>
<li>
<p>a å’Œ b å‘ç”Ÿåœ¨ç›¸åŒèŠ‚ç‚¹ï¼Œå¹¶ä¸”æŒ‰ç…§æœ¬åœ°èŠ‚ç‚¹çš„æ‰§è¡Œé¡ºåºï¼Œa å‘ç”Ÿåœ¨ b ä¹‹å‰ã€‚</p>
</li>
<li>
<p>äº‹ä»¶ a æ˜¯å‘é€æ¶ˆæ¯ mï¼Œäº‹ä»¶ b æ˜¯æ¥æ”¶ç›¸åŒçš„æ¶ˆæ¯ mï¼ˆå‡å®šå‘é€çš„æ¶ˆæ¯éƒ½æ˜¯å”¯ä¸€çš„ï¼‰ã€‚</p>
</li>
<li>
<p>æœ‰è¿™ä¹ˆä¸€ä¸ªæ—¶é—´ c æ»¡è¶³ï¼Œa â†’ c ä¸” c â†’ bã€‚</p>
<p>happens-before relation æ˜¯å±€éƒ¨çš„é¡ºåºï¼šæœ‰å¯èƒ½å­˜åœ¨æ—¢ä¸æ»¡è¶³ a â†’ b ä¹Ÿä¸æ»¡è¶³ b â†’ aï¼Œè¿™æ · a å’Œ b å°±æ˜¯å¹¶è¡Œçš„ï¼Œå†™ä½œ a || bã€‚</p>
</li>
</ul>
<h3 id="happen-before-relation-example">Happen-before relation example</h3>
<figure>
    <img loading="lazy" src="/ox-hugo/happens-before-example.png"
         alt="Figure 1: happens-before-example"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>happens-before-example</p>
        </figcaption>
</figure>

<ul>
<li>a â†’ b, c â†’ d, and e â†’ f due to process order</li>
<li>b â†’ c and d â†’ f due to messages m1 and m2</li>
<li>a â†’ c, a â†’ d, a â†’ f, b â†’ d, b â†’ f, and c â†’ f due to transitivity</li>
<li>a || e, b || e, c || e, and d || e</li>
</ul>
<h2 id="causality">Causality</h2>
<p>Happens-before relation å’Œ Causality åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è”ç³»éå¸¸ç´§å¯†</p>
<ul>
<li>å½“ a â†’ b, é‚£ä¹ˆ a å¯èƒ½æ˜¯ b çš„å› ã€‚</li>
<li>å½“ a || b, a å’Œ b ä¹‹é—´ä¸å­˜åœ¨å› æœå…³ç³»ã€‚</li>
</ul>
<figure>
    <img loading="lazy" src="/ox-hugo/causality.png"
         alt="Figure 2: causality"/> <figcaption>
            <p><span class="figure-number">Figure 2: </span>causality</p>
        </figcaption>
</figure>

<p>Let â‰º be a strict total order on events.</p>
<p>å¦‚æœ (a â†’ b) â‡’ (a â‰º b) ç¬¦å· â‰º å°±æ˜¯æ‰€è°“çš„å› æœé¡ºåºã€‚</p>
<p>å› æœå…³ç³»çš„æ¦‚å¿µæ˜¯ä»ç‰©ç†å­¦ä¸­å€Ÿé‰´çš„ï¼Œä¿¡æ¯çš„ä¼ æ’­é€Ÿåº¦ä¸å¯èƒ½è¶…è¿‡å…‰é€Ÿã€‚å› æ­¤å¦‚æœäº‹ä»¶ A å’Œäº‹ä»¶ B åœ¨ç©ºé—´ä¸Šç›¸è·å¾ˆè¿œï¼Œä½†æ˜¯åœ¨æ—¶é—´ä¸Šç›¸è·å¾ˆè¿‘ï¼Œé‚£ä¹ˆä»äº‹ä»¶ A å‘å‡ºçš„ä¿¡å·ä¸å¯èƒ½åœ¨äº‹ä»¶ B ä¹‹å‰åˆ°è¾¾ B çš„ä½ç½®ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤ A å’Œ B æ˜¯è‚¯å®šæ²¡æœ‰å› æœå…³ç³»çš„ã€‚</p>
<p>ä¸€ä¸ªåœ¨ç©ºé—´ä¸Šç¦» A å¾ˆè¿‘ï¼Œæ—¶é—´ä¸Šè·ç¦» A å¾ˆè¿œçš„äº‹ä»¶ Cï¼Œå°†åœ¨ A çš„å…‰é”¥å†…ï¼Œä¹Ÿå°±æ˜¯è¯´ A çš„ä¿¡å·æœ‰å¯èƒ½åˆ°è¾¾ Cï¼Œå› æ­¤ A å¯èƒ½å½±å“ Cã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œä¸Šçš„æ¶ˆæ¯è™½ç„¶ä¸åŒäºå…‰æŸï¼Œä½†åŸç†éå¸¸ç›¸ä¼¼ã€‚</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
